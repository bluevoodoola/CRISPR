<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link href='https://fonts.googleapis.com/css?family=Coda' rel='stylesheet' type='text/css'>
	<title>Hypercube Equivalence</title>
	<script type="text/javascript">var jslang='EN';</script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/smoothness/jquery-ui.css">
	<script type="text/javascript" src="ingress_items.js"></script>
	<link rel="stylesheet" href="hypercubes.css">
</head>
<body>
	<div id="layout" class="layout">
		<div style="margin:30px;">
		Agent Level
		<div id="sliderAgentLevel" class="slider"></div></div>
		<div style="margin:30px;">
		Target Cubes
		<div id="sliderTargetCubes" class="slider"></div></div>
		<div style="margin:30px;">
		Hypercube Count
		<div id="sliderHyperCount" class="slider"></div></div>

		<div id="inputs" class="Inputs Area" style="width : 33% ; clear : left;">
			<p>Your Agent Level is <input name="AgentLevel" id="AgentLevel" type="text" class="inputMeasure" value="16" />.</p>
			<p>Your team lead has recommended a target of <input name="TargetCount" id="TargetCount" type="text" class="inputMeasure" value="100" /> L8 Power Cubes for a total target capacity <span id="TargetXM" class="calc"></span> XM.</p>
			<p>A Hypercube is worth <span id="Worth" class="calc"></span> L8C for you at your level - it stores much greater density of XM.</p>
			<p>So we recommend having <span id="RL" class="calc"></span> Hypercubes to realize a maximum space savings of <span id="MaxSavings" class="calc"></span> inventory slots.
			<p>You currently have <input name="HyperCount" id="HyperCount" type="text" class="inputMeasure" value="0" /> Hypercubes.</p>
			<p>You will need an additional <span id="AddCubes" class="calc"></span> L8C to reach the target capacity.</p>
			<p>You will be using a total of <span id="Slots" class="calc"></span> inventory slots for all cubes, a savings of <span id="Savings" class="calc"></span></p>
			<p>You could still save <span id="CouldSave" class="calc"></span> more inventory slots for that target by getting <span id="MoreCubes" class="calc"></span> more Hypercubes.</p>
		</div>

		<div id="Chart" class="Chart Area" style="width : 33% ;">
			<canvas id="ChartCanvas" width="900", height="500" style="border : 5px solid black;"></canvas>
		</div>

		<div id="Instructions" class="Instructions Area" style="width : 33% ;">
			<p>Instructions: All team inventory requirements include some amount of L8 Powercubes.  Hypercubes
			have more stored XM, but the capacity varies by agent level.  Enter the recommended number of cubes,
			your level and the number of actual Hypercubes you have farmed and this app will show you
			how many Hypercubes you need and how many additional L8 Powercubes you need.</p>

			<p>You can also convert any cubes (over L4) to Hypercubes by using kinetic capsules.</p>

			<p>More cube capacity than is required for the anomaly is wasted space that could be used for gear you will use during the anomaly like bursters, shields, ultrastrikes, keys and resonators, so pump that extra XM into portals before the anomaly instead of carrying around useless gear.</p>

			<p><a href="https://fevgames.net/ingress/ingress-guide/items/power-cube/">https://fevgames.net/ingress/ingress-guide/items/power-cube/</a></p>
		</div>
	</div>

	<script>
		function calc() {
			var AgentLevel = $("#AgentLevel").val();
			const TargetCount = $("#TargetCount").val();
			const HyperCount = $("#HyperCount").val();

			if (!isNaN(parseFloat(AgentLevel)) && isFinite(AgentLevel)) {
				AgentLevel = Math.floor(AgentLevel);
				const Worth = INGRESS_ITEMS.STATS_HYPER[AgentLevel].XM / INGRESS_ITEMS.STATS_POWERCUBE["8"].XM;
				$("#Worth").text(Worth);
			}

			if (!isNaN(parseFloat(TargetCount)) && isFinite(TargetCount) && !isNaN(parseFloat(AgentLevel)) && isFinite(AgentLevel) && !isNaN(parseFloat(HyperCount)) && isFinite(HyperCount)) {
				const calcs = {
					update: function(AgentLevel, TargetCount, HyperCount) {
						this.TargetCount = Math.floor(TargetCount);
						this.HyperCount = Math.floor(HyperCount);
						this.RL = Math.ceil(this.TargetCount / (INGRESS_ITEMS.STATS_HYPER[AgentLevel].XM / INGRESS_ITEMS.STATS_POWERCUBE["8"].XM));
						this.AL = this.HyperCount;
						this.TargetXM = this.TargetCount * INGRESS_ITEMS.STATS_POWERCUBE["8"].XM;
						this.HyperXM = this.AL * INGRESS_ITEMS.STATS_HYPER[AgentLevel].XM;
						this.AddCubes = Math.min(this.TargetCount, Math.max(0, Math.ceil((this.TargetXM - this.HyperXM) / INGRESS_ITEMS.STATS_POWERCUBE["8"].XM)));
						this.Slots = this.AL + this.AddCubes;
						this.Savings = this.TargetCount - this.Slots;
						this.MaxSavings = this.TargetCount - this.RL;
						this.CubeXM = this.AddCubes * INGRESS_ITEMS.STATS_POWERCUBE["8"].XM;
						this.ActualXM = this.HyperXM + this.CubeXM;
						this.CouldSave = this.MaxSavings - this.Savings;
						this.MoreCubes = this.RL - this.AL;
					}
				};

				calcs.update(AgentLevel, TargetCount, HyperCount);

				$(".calc").each(function() {$(this).text(calcs["this.id"])});

				var canvas = $("#ChartCanvas")[0];
				var ChartTargetXM = Math.max(calcs.TargetXM, calcs.ActualXM);
				var HyperPct = calcs.HyperXM / ChartTargetXM;
				var CubePct = calcs.CubeXM / ChartTargetXM;

				canvas.height = ChartTargetXM / 2000;
				const chartHeight = canvas.height;
				const chartWidth = canvas.width / 4;

				var HyperHeight = chartHeight * HyperPct;
				var CubeHeight = chartHeight * CubePct;
				var padding = 10 ;
				var fontHeight = 28;
				var fontStyle = "normal normal " + fontHeight + "px Coda";

				var ctx = canvas.getContext("2d");
				
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(0, 0, chartWidth, chartHeight);
				ctx.font = fontStyle;
				ctx.fillStyle = "black";
				ctx.textAlign = "center";
				ctx.fillText(`${ChartTargetXM} Actual XM`, chartWidth / 2, (chartHeight + fontHeight) / 2, chartWidth - padding * 2);
				ctx.fillText(`${calcs.TargetXM} Target XM`, chartWidth / 2, (chartHeight + fontHeight) / 2 + fontHeight, chartWidth - padding * 2);

				ctx.fillStyle = "#0000FF";
				ctx.fillRect(chartWidth, 0, chartWidth, HyperHeight);
				ctx.font = fontStyle;
				ctx.fillStyle = "black";
				ctx.textAlign = "center";
				if ( calcs.AL > 0 ) {
					ctx.fillText(`${calcs.HyperXM} Hypercube XM`, 1.5 * chartWidth, (HyperHeight + fontHeight) / 2, chartWidth - padding * 2);
					ctx.fillText(`${calcs.AL} Hypercubes`, 1.5 * chartWidth, (HyperHeight + fontHeight) / 2 + fontHeight, chartWidth - padding * 2);
				}

				ctx.fillStyle = "#0000DD";
				ctx.fillRect(chartWidth, HyperHeight, chartWidth, CubeHeight);
				ctx.font = fontStyle;
				ctx.fillStyle = "black";
				ctx.textAlign = "center";
				if (calcs.AddCubes > 0) {
					ctx.fillText(`${calcs.CubeXM} Cube XM`, 1.5 * chartWidth, HyperHeight + (CubeHeight + fontHeight) / 2, chartWidth - padding * 2);
					ctx.fillText(`${calcs.AddCubes} L8 Cubes`, 1.5 * chartWidth, HyperHeight + (CubeHeight + fontHeight) / 2 + fontHeight, chartWidth - padding * 2);
				}

				for (let lp = 0 ; lp < calcs.AL ; lp++) {
					ctx.fillStyle = "#0000EE";
					ctx.fillRect(2 * chartWidth, lp * HyperHeight / calcs.AL, chartWidth, HyperHeight / calcs.AL);
					ctx.lineWidth = 2;
					ctx.strokeStyle = "black";
					ctx.strokeRect(2 * chartWidth, lp * HyperHeight / calcs.AL, chartWidth, HyperHeight / calcs.AL);
				};

				for (let lp = 0 ; lp < calcs.AddCubes ; lp++) {
					ctx.fillStyle = "#0000AA";
					ctx.fillRect(2 * chartWidth, HyperHeight + lp * CubeHeight / calcs.AddCubes, chartWidth, CubeHeight / calcs.AddCubes);
					ctx.lineWidth = 2;
					ctx.strokeStyle = "black";
					ctx.strokeRect(2 * chartWidth, HyperHeight + lp * CubeHeight / calcs.AddCubes, chartWidth, CubeHeight / calcs.AddCubes);
				};

				for (let lp = 0 ; lp < calcs.TargetCount ; lp++) {
					if (lp < calcs.Slots){
						ctx.fillStyle = "#0000AA";
						ctx.fillRect(3 * chartWidth, lp * chartHeight / calcs.TargetCount, chartWidth, chartHeight / calcs.TargetCount);
						ctx.lineWidth = 2;
						ctx.strokeStyle = "black";
						ctx.strokeRect(3 * chartWidth, lp * chartHeight / calcs.TargetCount, chartWidth, chartHeight / calcs.TargetCount);
					}
					else {
						//ctx.fillStyle = "#FFFFFF";
						//ctx.fillRect(3 * chartWidth, lp * chartHeight / TargetCount, chartWidth, chartHeight / TargetCount);
						//ctx.lineWidth = 2;
						// ctx.strokeStyle = "black";
						// ctx.strokeRect(3 * chartWidth, lp * chartHeight / TargetCount, chartWidth, chartHeight / TargetCount);
					}
				}

				ctx.font = fontStyle;
				ctx.fillStyle = "black";
				ctx.textAlign = "center";
				ctx.fillText(calcs.Savings + " Slots Freed", 3.5 * chartWidth, calcs.Slots * chartHeight / calcs.TargetCount + (calcs.TargetCount - calcs.Slots) * chartHeight / (2 * calcs.TargetCount), chartWidth - padding * 2);

				initHyperSlider(calcs.HyperCount, calcs.RL);
			}
			else {
				$(".calc").each(function() {$(this).text("")});
			}
		}

		$(".inputMeasure").on("input", function () { calc(); });
		$(".inputMeasure").on("change", function () { calc(); });

		function initGenericSlider(SliderSelector, ValueSelector, min, max, step, value, className) {
			$( SliderSelector ).slider({
			  value: value,
			  min: min,
			  max: max,
			  step: step,
			  slide: function( event, ui ) {
				$( ValueSelector ).val( ui.value );
				calc();
			  }
			}).each(function() {
				var opt = $(this).data().uiSlider.options;
				var vals = ((opt.max - opt.min) / (opt.step));
				for (var i = 0; i <= vals; i++) {
					var el = $('<label' + (className !== '' ? ' class="' + className + '"' : '') + '>' + (opt.min + i * opt.step) + '</label>').css('left', (i/vals*100) + '%');
					$(this).append(el);
				}
			});

			$( ValueSelector ).val( $( SliderSelector ).slider( "value" ) );
		}

		function initHyperSlider(CurrentCount, TargetCount) {
			$(".lclabels").remove();
			initGenericSlider("#sliderHyperCount", "#HyperCount", 0, TargetCount, 1, CurrentCount, "lclabels")
		};

		$(function() {
			initGenericSlider("#sliderAgentLevel", "#AgentLevel", 8, 16, 1, 16, "");
			initGenericSlider("#sliderTargetCubes", "#TargetCount", 100, 200, 10, 100, "");
			initHyperSlider(0, 16);
			calc();
		});
	</script>
</body>
</html>